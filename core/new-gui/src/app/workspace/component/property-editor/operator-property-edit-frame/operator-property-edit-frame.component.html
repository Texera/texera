<div
  *ngIf="!editingTitle"
  id="formly-title">
  <h3
    *ngIf="!editingTitle && formTitle"
    class="texera-workspace-property-editor-title">
    {{ formTitle }}
  </h3>
  <button
    (click)="editingTitle=true; connectQuillToText()"
    nz-button
    nz-tooltip="Customize Operator Name"
    nzSize="small"
    nzTooltipPlacement="bottom"
    nzType="text"
    [disabled]="!interactive">
    <i
      nz-icon
      nzTheme="outline"
      nzType="edit"></i>
  </button>
  <i
    *ngIf="currentOperatorId?.includes('PythonLambdaFunction')"
    nz-icon
    nz-popover
    nzPopoverTitle="Python Lambda Function Instructions"
    nzType="question-circle"
    nzTheme="outline"
    [nzPopoverContent]="PythonLambdaPopContent"></i>

  <ng-template #PythonLambdaPopContent>
    You can add a new column by:
    <ul>
      <li>Click on the blue <strong>"+"</strong> button</li>
      <li>Select <strong>"Add New Column"</strong> in the drop-down list of the first field</li>
      <li>Type the name of the new column</li>
      <li>Select the attribute type</li>
      <li>Type the expression using Python syntax</li>
    </ul>
    You can modify an existing column by:
    <ul>
      <li>Click on the blue <strong>"+"</strong> button</li>
      <li>Select one existing column in the drop-down list of the first field</li>
      <li>Select the attribute type</li>
      <li>Type the expression using Python syntax</li>
    </ul>
    You can get the value of any existing attribute in the expression by:
    <ul>
      <li>Type <strong>tuple_["$attributeName"]</strong> in the expression field</li>
      <li>Replace <strong>$attributeName</strong> with the attributeName you want to access</li>
    </ul>
    <br />
    Example: Add a new column called IsExpensive where the value is True if unit price > 500<br />
    Operations:
    <ul>
      <li>Click on the blue "+" button</li>
      <li>Select "Add New Column" in the drop-down list of the first field</li>
      <li>Type the name of the new column as <strong>IsExpensive</strong></li>
      <li>Select the attribute type as <strong>boolean</strong></li>
      <li>Type the expression as <strong>True if tuple_["Unit Price"] > 500 else False</strong></li>
    </ul>
  </ng-template>
</div>

<div
  id="customName"
  [hidden]="!editingTitle"
  (focusout)="disconnectQuillFromText()"
  (keyup.enter)="disconnectQuillFromText()"></div>

<form
  *ngIf="formlyFields && formlyFormGroup"
  [formGroup]="formlyFormGroup"
  class="texera-workspace-property-editor-form">
  <formly-form
    (modelChange)="onFormChanges($event)"
    [fields]="formlyFields"
    [form]="formlyFormGroup"
    [model]="formData"
    [options]="formlyOptions">
  </formly-form>
  <ndc-dynamic
    [ndcDynamicComponent]="extraDisplayComponentConfig?.component"
    [ndcDynamicInputs]="extraDisplayComponentConfig?.componentInputs ?? {}"></ndc-dynamic>
</form>

<button
  (click)="allowModifyOperatorLogic()"
  *ngIf="
		currentOperatorId !== undefined &&
		(this.executeWorkflowService.getExecutionState().state ===
			ExecutionState.Paused ||
			this.executeWorkflowService.getExecutionState().state ===
				ExecutionState.BreakpointTriggered) &&
		this.interactive === false"
  nz-button
  nz-tooltip="Unlock the operator to change logic"
  nzTooltipPlacement="bottom"
  [disabled]="!lockGranted">
  Unlock for Logic Change
  <i
    nz-icon
    nzTheme="outline"
    nzType="unlock"></i>
</button>

<button
  (click)="confirmModifyOperatorLogic()"
  *ngIf="
		currentOperatorId !== undefined &&
		(this.executeWorkflowService.getExecutionState().state ===
			ExecutionState.Paused ||
			this.executeWorkflowService.getExecutionState().state ===
				ExecutionState.BreakpointTriggered) &&
		this.interactive === true"
  nz-button
  nz-tooltip="Confirm change and modify the operator runtime"
  nzTooltipPlacement="bottom"
  [disabled]="!lockGranted">
  Confirm Change
</button>

<div class="operator-version">
  <span>Operator Version: {{ operatorVersion }}</span>
</div>
